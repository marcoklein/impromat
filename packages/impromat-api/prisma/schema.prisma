datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Element {
  id        String   @id @default(uuid())
  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
  version   Int
  deleted   Boolean  @default(false)

  name          String
  markdown      String?
  note          String
  languageCode  String?
  sourceUrl     String?
  sourceName    String?
  sourceBaseUrl String?
  licenseName   String?
  licenseUrl    String?

  basedOnId String? @unique
  userId    String?
  sectionId String?

  basedOn             Element?              @relation("BasedOn", fields: [basedOnId], references: [id])
  parentOf            Element[]             @relation("BasedOn")
  tags                ElementTag[]
  workshopSection     WorkshopSection?      @relation(fields: [sectionId], references: [id])
  user                User?                 @relation(fields: [userId], references: [id])
  userFavoriteElement UserFavoriteElement[]
}

model ElementTag {
  id        String   @id @default(uuid())
  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
  version   Int      @default(0)

  name     String
  elements Element[]
}

model UserFavoriteElement {
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  version   Int      @default(0)

  userId    String
  elementId String

  element Element @relation(fields: [elementId], references: [id])
  user    User    @relation(fields: [userId], references: [id])

  @@id([userId, elementId])
}

model User {
  id        String    @id @default(uuid())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  version   Int       @default(0)
  deleted   Boolean   @default(false)
  deletedAt DateTime?

  name                 String? @unique
  googleSubscriptionId String? @unique

  favoriteElements UserFavoriteElement[]
  workshops        Workshop[]
  elements         Element[]
}

model Workshop {
  id        String   @id @default(uuid())
  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
  version   Int      @default(0)
  deleted   Boolean  @default(false)

  name        String
  description String?

  ownerId String

  sections WorkshopSection[]
  owner    User              @relation(fields: [ownerId], references: [id])
}

model WorkshopSection {
  id        String    @id @default(uuid())
  updatedAt DateTime  @updatedAt
  createdAt DateTime  @default(now())
  version   Int       @default(0)
  deleted   Boolean   @default(false)
  deletedAt DateTime?

  name        String?
  color       String?
  isCollapsed Boolean @default(false)

  workshopId String

  elements Element[]
  workshop Workshop  @relation(fields: [workshopId], references: [id])
}

"""
Integer holding milliseconds since UNIX epoch start.
"""
scalar SafeInt

type Query {
  """
  Returns new workshops since last sync.
  """
  pullWorkshops(
    checkpoint: PullCheckpointInput!
    limit: Int!
  ): WorkshopPullBulk!
  """
  Returns new elements since last sync.
  """
  pullElements(checkpoint: PullCheckpointInput!, limit: Int!): ElementPullBulk!
  """
  Returns new users since last sync.
  """
  pullUsers(checkpoint: PullCheckpointInput!, limit: Int!): UserPullBulk!
  """
  Returns an authentication url for google authentication.
  """
  googleAuthUrl: String!
  """
  Information about the logged in session.
  Null indicates a not logged in user.
  """
  me: TokenInfo
  """
  Version of the application.
  """
  version: String!
}

type Mutation {
  """
  Update given workshops.
  Returns conflicting workshops. That means the client has to resolve all workshops that the call returns.
  """
  pushWorkshops(workshopPushRows: [WorkshopPushRowInput!]!): [Workshop]
  """
  Update given elements.
  Returns conflicting elements. That means the client has to resolve all elements that the call returns.
  """
  pushElements(elementPushRows: [ElementPushRowInput!]!): [Element]
  """
  Update given sections.
  Returns conflicting sections. That means the client has to resolve all sections that the call returns.
  """
  pushSections(sectionPushRows: [SectionPushRowInput!]!): [Section]
  """
  Update user info of the logged in user.
  Returns current master state if there is a conflict.
  Throws an error if the user is not logged in.
  """
  pushUser(userPushRow: UserPushRowInput!): User
  """
  Update given users.
  Returns conflicting users. That means the client has to resolve all users that the call returns.
  """
  pushUsers(userPushRows: [UserPushRowInput!]!): [User]
  """
  Log out from the application.
  Returns true if the user was logged in and got logged out successfully.
  Returns undefined, if the user was not logged in.
  """
  logout: Boolean!
}

input PullCheckpointInput {
  id: ID!
  updatedAt: SafeInt!
}

input WorkshopPushRowInput {
  assumedMasterState: WorkshopInput
  newDocumentState: WorkshopInput!
}

input ElementPushRowInput {
  assumedMasterState: ElementInput
  newDocumentState: ElementInput!
}

input SectionPushRowInput {
  assumedMasterState: SectionInput
  newDocumentState: SectionInput!
}

input WorkshopInput {
  id: ID!
  deleted: Boolean
  updatedAt: SafeInt
  name: String
  description: String
  sections: [SectionInput]
}

input SectionInput {
  id: ID!
  version: Int!
  name: String
  elements: [ElementInput!]
  note: String
  color: String
  isVisible: Boolean
  isCollapsed: Boolean
}

input ElementInput {
  id: ID!
  version: Int!
  name: String!
  markdown: String
  tags: [String!]
  note: String
  """
  Ref with id to other Element.
  """
  basedOn: ID
  languageCode: String
  sourceUrl: String
  sourceName: String
  sourceBaseUrl: String
  licenseName: String
  licenseUrl: String
}

type WorkshopPullBulk {
  documents: [Workshop!]!
  checkpoint: PullCheckpoint
}

type ElementPullBulk {
  documents: [Element!]!
  checkpoint: PullCheckpoint
}

type SectionPullBulk {
  documents: [Section!]!
  checkpoint: PullCheckpoint
}

type UserPullBulk {
  documents: [User!]!
  checkpoint: PullCheckpoint
}

type PullCheckpoint {
  id: String!
  updatedAt: Float!
}

type TokenInfo {
  userId: String!
  user: User!
}

input UserPushRowInput {
  assumedMasterState: UserInput
  newDocumentState: UserInput!
}

input UserInput {
  version: Int!
  favoriteElements: [ID!]
}

"""
Information about a user that uses Impromat.
"""
type User {
  """
  Id of the user.
  """
  id: ID!
  """
  Entity version.
  """
  version: Int!
  favoriteElements: [Element!]!
}

"""
An improvisational theatre Workshop that a person can hold for their group.
"""
type Workshop {
  id: ID!
  updatedAt: SafeInt!
  """
  For syncing purposes this flag indicates deleted workshops.
  """
  deleted: Boolean
  name: String!
  description: String!
  sections: [Section!]!
}

"""
A section groups several elements of a workshop.
A workshop must always have at least one section.
"""
type Section {
  id: ID!
  version: Int!
  name: String!
  elements: [Element!]!
  note: String
  color: String
  """
  If false the section will not be shown.
  If there are no sections yet there is an invisiable ghost section to hold all elements.
  """
  isVisible: Boolean
  isCollapsed: Boolean
}

"""
General element like a exercise or game.
"""
type Element {
  id: ID!
  version: Int!
  name: String!
  markdown: String!
  tags: [String!]!
  """
  User defined note
  """
  note: String!
  basedOn: Element
  languageCode: String
  sourceUrl: String
  sourceName: String
  sourceBaseUrl: String
  licenseName: String
  licenseUrl: String
}

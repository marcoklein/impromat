FROM node:16-alpine

ARG REACT_APP_API_URL
ENV REACT_APP_API_URL ${REACT_APP_API_URL}
RUN echo "REACT_APP_API_URL=$REACT_APP_API_URL"

WORKDIR /app
COPY . .

RUN echo "Building monorepo"
RUN yarn install --frozen-lockfile

RUN echo "Building impromat app"
WORKDIR /app/packages/impromat
RUN yarn build

CMD ["yarn", "build:serve"]
